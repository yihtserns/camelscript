package com.github.yihtserns.camelscript.transform

import org.apache.camel.Exchange
import org.apache.camel.TypeConverter

typeConverterRegistry.addTypeConverter(Date, String, new TypeConverter() {

        def mandatoryConvertTo(Class type, Object value) {
            Date.parse('yyyy-MM-dd', value)
        }

        def convertTo(Class type, Object value) {
            mandatoryConvertTo(type, value)
        }
        def convertTo(Class type, Exchange exchange, Object value) {
            mandatoryConvertTo(type, value)
        }

        def mandatoryConvertTo(Class type, Exchange exchange, Object value) {
            mandatoryConvertTo(type, value)
        }
    })

routes {
    from 'direct:process' process { it.out.body = it.in as Date }
    from 'direct:transform' transform { it.in as Date }
}

def routes = ['direct:process', 'direct:transform']
def dates = routes.collect { route ->
    createProducerTemplate().requestBody(route, '2013-04-26')
}